<section class="grid gap-6 fade-up">
  <!-- Tabs (pill segmented control) -->
  <div class="rounded-2xl shadow-md bg-white/80 backdrop-blur p-2">
    <div class="flex flex-wrap gap-2">
      <button class="tab-btn h-9 px-4 rounded-lg text-sm font-medium bg-slate-100 hover:bg-slate-200 transition cursor-pointer"
              data-tab="hero" aria-selected="true">Hero</button>
      <button class="tab-btn h-9 px-4 rounded-lg text-sm font-medium bg-slate-100 hover:bg-slate-200 transition cursor-pointer"
              data-tab="cards">Cards</button>
      <button class="tab-btn h-9 px-4 rounded-lg text-sm font-medium bg-slate-100 hover:bg-slate-200 transition cursor-pointer"
              data-tab="about">About</button>
      <button class="tab-btn h-9 px-4 rounded-lg text-sm font-medium bg-slate-100 hover:bg-slate-200 transition cursor-pointer"
              data-tab="policies">Policies</button>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="rounded-2xl shadow-md bg-white/80 backdrop-blur p-3 flex flex-wrap items-center justify-between gap-3">
    <div id="tabTitle" class="font-semibold tracking-tight">Hero Images</div>
    <div class="flex flex-wrap gap-2">
      <button id="btnAdd"
        class="px-4 py-2 cursor-pointer rounded-lg text-sm text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-md transition">
        Add
      </button>
      <button id="btnReorder"
        class="py-2 px-4 cursor-pointer rounded-lg text-sm bg-slate-100 hover:bg-slate-200 shadow-sm transition">
        Reorder
      </button>
    </div>
  </div>

  <!-- Panels -->
  <!-- HERO -->
  <div id="panel-hero" class="rounded-2xl shadow-md bg-white/80 backdrop-blur p-4">
    <h2 class="font-semibold mb-3">Hero Images</h2>
    <div id="heroGrid" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
  </div>

  <!-- CARDS -->
  <div id="panel-cards" class="rounded-2xl shadow-md bg-white/80 backdrop-blur p-4 hidden">
    <h2 class="font-semibold mb-3">Display Cards</h2>
    <div id="cardGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3"></div>
  </div>

  <!-- ABOUT -->
  <div id="panel-about" class="rounded-2xl shadow-md bg-white/80 backdrop-blur p-4 hidden">
    <h2 class="font-semibold mb-3">About</h2>
    <div id="aboutList" class="grid gap-3"></div>
  </div>

  <!-- POLICIES -->
  <div id="panel-policies" class="rounded-2xl shadow-md bg-white/80 backdrop-blur p-4 hidden">
    <h2 class="font-semibold mb-3">Policies</h2>
    <div id="policyList" class="grid gap-3"></div>
  </div>
</section>

<!-- Modals -->
<!-- Add/Edit (glass card) -->
<div id="editModal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center p-4 z-50">
  <div class="w-full max-w-lg rounded-2xl bg-white/90 backdrop-blur shadow-2xl p-6">
    <h3 id="editTitle" class="text-lg font-semibold mb-4">Edit</h3>
    <form id="editForm" class="grid gap-3">
      <div id="editFields" class="grid gap-3"></div>
      <div class="mt-4 flex justify-end gap-2">
        <button type="button" id="cancelEdit"
                class="h-9 px-4 rounded-lg bg-slate-100 hover:bg-slate-200 shadow-sm transition">Cancel</button>
        <button type="submit" id="saveEdit"
                class="h-9 px-4 rounded-lg text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-md transition">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete (glass card) -->
<div id="deleteModal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center p-4 z-50">
  <div class="w-full max-w-md rounded-2xl bg-white/90 backdrop-blur shadow-2xl p-6">
    <h3 class="text-lg font-semibold mb-2">Delete</h3>
    <p id="deleteText" class="text-sm text-slate-600"></p>
    <div class="mt-5 flex justify-end gap-2">
      <button id="cancelDelete"
              class="h-9 px-4 rounded-lg bg-slate-100 hover:bg-slate-200 shadow-sm transition">Cancel</button>
      <button id="confirmDelete"
              class="h-9 px-4 rounded-lg text-white bg-gradient-to-r from-rose-500 to-red-600 hover:from-rose-600 hover:to-red-700 shadow-md transition">Delete</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast"
     class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden bg-slate-900 text-white text-sm px-3 py-2 rounded-lg shadow-lg"></div>

<script>
(function(){
  // In-memory demo data for About & Policies
  let ABOUT = [
    { id: 'about',  title: 'About TrueStyle', body: 'TrueStyle crafts timeless fashion with modern comfort.' },
    { id: 'mission', title: 'Mission', body: 'Deliver quality apparel at fair prices with sustainable practices.' },
    { id: 'vision',  title: 'Vision', body: 'Be India’s most-loved everyday fashion brand.' },
    { id: 'story',   title: 'Our Story', body: 'Started in 2025 by college makers, grown by our community.' }
  ];
  let POLICIES = [
    { id: 'shipping', title: 'Shipping Policy', body: 'Dispatch in 1–2 business days. PAN-India delivery with tracking.' },
    { id: 'returns',  title: 'Returns & Refunds', body: '30-day easy returns. Item should be unused and in original packaging.' },
    { id: 'privacy',  title: 'Privacy Policy', body: 'We collect minimal data and never sell your information.' },
    { id: 'terms',    title: 'Terms of Service', body: 'Using this site means you agree to our standard terms.' }
  ];

  // Elements
  const tabs = document.querySelectorAll('.tab-btn');
  const panels = {
    hero: document.getElementById('panel-hero'),
    cards: document.getElementById('panel-cards'),
    about: document.getElementById('panel-about'),
    policies: document.getElementById('panel-policies')
  };
  const tabTitle = document.getElementById('tabTitle');
  const btnAdd = document.getElementById('btnAdd');
  const btnReorder = document.getElementById('btnReorder');
  const heroGrid = document.getElementById('heroGrid');
  const cardGrid = document.getElementById('cardGrid');
  const aboutList = document.getElementById('aboutList');
  const policyList = document.getElementById('policyList');
  const toast = document.getElementById('toast');

  let activeTab = 'hero';
  let deleteCtx = null;  // {tab,id}
  let editCtx = null;    // {tab,mode,id?}

  // Helpers
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.remove('hidden');
    setTimeout(()=> toast.classList.add('hidden'), 1400);
  }
  function setToolbarFor(tab){
    const map = {
      hero:     { title: 'Hero Images', note: 'Preview-only in Phase-1', showReorder: true, showBulk: true },
      cards:    { title: 'Display Cards', note: 'Preview-only in Phase-1', showReorder: true, showBulk: true },
      about:    { title: 'About', note: 'Demo: in-memory CRUD', showReorder: false, showBulk: false },
      policies: { title: 'Policies', note: 'Demo: in-memory CRUD', showReorder: false, showBulk: false }
    };
    tabTitle.textContent = map[tab].title;
    btnReorder.classList.toggle('hidden', !map[tab].showReorder);
  }
  function switchTab(tab){
    activeTab = tab;
    Object.entries(panels).forEach(([k,el])=> el.classList.toggle('hidden', k!==tab));
    tabs.forEach(b=>{
      const on = b.dataset.tab===tab;
      b.setAttribute('aria-selected', on ? 'true' : 'false');
      b.classList.toggle('bg-slate-100', !on);
      b.classList.toggle('bg-gradient-to-r', on);
      b.classList.toggle('from-blue-600', on);
      b.classList.toggle('to-indigo-600', on);
      b.classList.toggle('text-white', on);
      b.classList.toggle('shadow-md', on);
    });
    setToolbarFor(tab);
  }

  // Renderers (no borders; soft shadows; glass overlay for actions)
  function renderHero(){
    const rows = (window.AppDB?.select) ? AppDB.select('Hero_Image') : [];
    heroGrid.innerHTML = rows.length ? rows.map(h => `
      <article class="group relative rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition bg-white">
        <img src="${h.image_url}" class="w-full h-36 md:h-44 object-cover" alt="">
        <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-black/10 to-transparent opacity-0 group-hover:opacity-100 transition"></div>
        <div class="absolute bottom-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition">
          <button class="px-4 py-2 rounded-lg bg-white/90 backdrop-blur text-md shadow cursor-pointer">Edit</button>
          <button class="px-4 py-2 rounded-lg bg-rose-600 text-white text-md shadow cursor-pointer">Delete</button>
        </div>
      </article>
    `).join('') : `<div class="col-span-full text-sm text-slate-500">No hero images in AppDB.</div>`;
  }
  function renderCards(){
    const rows = (window.AppDB?.select) ? AppDB.select('Display_Card') : [];
    cardGrid.innerHTML = rows.length ? rows.map(c => `
      <article class="group relative rounded-xl p-3 text-center shadow-sm hover:shadow-lg transition bg-white">
        <img src="${c.Image_url}" class="w-full h-20 object-contain" alt="">
        <div class="text-xs mt-2 font-medium">${c.Title}</div>
        <div class="absolute bottom-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition">
          <button class="py-2 px-4 rounded-lg bg-white/90 backdrop-blur text-md shadow cursor-pointer">Edit</button>
          <button class="py-2 px-4 rounded-lg bg-rose-600 text-white text-md shadow cursor-pointer">Delete</button>
        </div>
      </article>
    `).join('') : `<div class="col-span-full text-sm text-slate-500">No display cards in AppDB.</div>`;
  }
  function itemCard(title, body, id, tab){
    return `
      <article class="rounded-2xl p-4 shadow-sm hover:shadow-lg transition bg-white">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="font-semibold tracking-tight">${title}</div>
            <p class="text-sm text-slate-700 mt-1 leading-relaxed">${body}</p>
          </div>
          <div class="flex gap-2 shrink-0">
            <button class="py-2 px-4 rounded-lg bg-slate-100 hover:bg-slate-200 text-md shadow-sm transition cursor-pointer"
                    data-action="edit" data-id="${id}" data-tab="${tab}">Edit</button>
            <button class="py-2 px-4 rounded-lg bg-gradient-to-r from-rose-500 to-red-600 text-white text-md shadow-md transition cursor-pointer"
                    data-action="delete" data-id="${id}" data-tab="${tab}">Delete</button>
          </div>
        </div>
      </article>
    `;
  }
  function renderAbout(){ aboutList.innerHTML = ABOUT.map(a => itemCard(a.title, a.body, a.id, 'about')).join(''); }
  function renderPolicies(){ policyList.innerHTML = POLICIES.map(p => itemCard(p.title, p.body, p.id, 'policies')).join(''); }

  // Delegated edit/delete for About/Policies (Hero/Cards remain UI-only)
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-action]');
    if (!btn) return;
    const { action, id, tab } = btn.dataset;
    if (action==='edit') openEdit(tab, id);
    if (action==='delete') openDelete(tab, id);
  });

  // Toolbar actions
  btnAdd.onclick = ()=> openEdit(activeTab, null);
  btnReorder.onclick = ()=> (activeTab==='hero'||activeTab==='cards') ? showToast('') : null;

  // Tabs
  tabs.forEach(b => b.addEventListener('click', ()=> switchTab(b.dataset.tab)));

  // Modals
  const editModal = document.getElementById('editModal');
  const editTitle = document.getElementById('editTitle');
  const editFields = document.getElementById('editFields');
  const editForm = document.getElementById('editForm');
  const deleteModal = document.getElementById('deleteModal');
  const deleteText = document.getElementById('deleteText');

  document.getElementById('cancelEdit').onclick = ()=> editModal.classList.add('hidden');
  document.getElementById('cancelDelete').onclick = ()=> deleteModal.classList.add('hidden');

  function openEdit(tab, id){
    editCtx = { tab, mode: id ? 'edit' : 'add', id };
    editFields.innerHTML = '';
    if (tab==='hero'){
      editTitle.textContent = (id?'Edit':'Add') + ' Hero Image';
      editFields.innerHTML = `
        <label class="grid gap-1">
          <span class="text-xs text-slate-600">Image URL</span>
          <input name="image_url" class="h-10 px-3 rounded-xl bg-slate-50 focus:outline-none focus:ring-2 ring-blue-200 shadow-inner"
                 placeholder="https://..." />
        </label>
      `;
    } else if (tab==='cards'){
      editTitle.textContent = (id?'Edit':'Add') + ' Display Card';
      editFields.innerHTML = `
        <label class="grid gap-1">
          <span class="text-xs text-slate-600">Title</span>
          <input name="Title" class="h-10 px-3 rounded-xl bg-slate-50 focus:outline-none focus:ring-2 ring-blue-200 shadow-inner"
                 placeholder="e.g., Fast Delivery" />
        </label>
        <label class="grid gap-1">
          <span class="text-xs text-slate-600">Image URL</span>
          <input name="Image_url" class="h-10 px-3 rounded-xl bg-slate-50 focus:outline-none focus:ring-2 ring-blue-200 shadow-inner"
                 placeholder="https://..." />
        </label>
      `;
    } else {
      const isAbout = tab==='about';
      const current = (isAbout ? ABOUT : POLICIES).find(x=> String(x.id)===String(id));
      editTitle.textContent = (id?'Edit ':'Add ') + (isAbout ? 'About Section' : 'Policy');
      editFields.innerHTML = `
        <label class="grid gap-1">
          <span class="text-xs text-slate-600">Title</span>
          <input name="title" class="h-10 px-3 rounded-xl bg-slate-50 focus:outline-none focus:ring-2 ring-blue-200 shadow-inner"
                 value="${current?.title||''}" />
        </label>
        <label class="grid gap-1">
          <span class="text-xs text-slate-600">Body</span>
          <textarea name="body" rows="5"
                    class="px-3 py-2 rounded-xl bg-slate-50 focus:outline-none focus:ring-2 ring-blue-200 shadow-inner">${current?.body||''}</textarea>
        </label>
      `;
    }
    editModal.classList.remove('hidden');
  }

  function openDelete(tab, id){
    deleteCtx = { tab, id };
    const name =
      tab==='about'   ? (ABOUT.find(x=> String(x.id)===String(id))?.title || 'this section') :
      tab==='policies'? (POLICIES.find(x=> String(x.id)===String(id))?.title || 'this policy') :
      `ID ${id}`;
    deleteText.textContent = `Delete ${name}?`;
    deleteModal.classList.remove('hidden');
  }

  editForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    const fd = new FormData(editForm);
    if (editCtx.tab==='about' || editCtx.tab==='policies'){
      const title = (fd.get('title')||'').trim();
      const body  = (fd.get('body')||'').trim();
      if (!title){ showToast('Title required'); return; }
      const list = editCtx.tab==='about' ? ABOUT : POLICIES;
      if (editCtx.mode==='add'){
        list.push({ id: Math.random().toString(36).slice(2,9), title, body });
      } else {
        const i = list.findIndex(x=> String(x.id)===String(editCtx.id));
        if (i>-1) list[i] = { ...list[i], title, body };
      }
      editModal.classList.add('hidden');
      (editCtx.tab==='about' ? renderAbout : renderPolicies)();
      showToast('Saved');
    } else {
      editModal.classList.add('hidden');
      showToast('UI only in Phase-1');
    }
  });

  document.getElementById('confirmDelete').onclick = ()=>{
    const { tab, id } = deleteCtx || {};
    if (!tab) return;
    if (tab==='about'){ ABOUT = ABOUT.filter(x=> String(x.id)!==String(id)); renderAbout(); }
    else if (tab==='policies'){ POLICIES = POLICIES.filter(x=> String(x.id)!==String(id)); renderPolicies(); }
    else { showToast('UI only in Phase-1'); }
    deleteModal.classList.add('hidden');
  };

  // Mount
  function mount(){
    // default unselected pill style
    tabs.forEach(b=> b.classList.add('shadow-sm'));
    switchTab('hero');
    renderHero(); renderCards(); renderAbout(); renderPolicies();
  }

  const prev = window.postPageMount;
  window.postPageMount = function(){ prev?.(); mount(); };
  if (!prev) mount();
})();
</script>